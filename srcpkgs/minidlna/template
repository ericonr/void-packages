# Template file for 'minidlna'
pkgname=minidlna
version=1.3.1
revision=1
_hash=66939d5ac4986020764c0518455f55b68422369f
wrksrc=minidlna-git-${_hash}
build_style=gnu-configure
configure_args="
 --sbindir=/usr/bin
 --with-db-path=/var/db/minidlna
 --with-os-url=http://www.voidlinux.org"
conf_files="/etc/minidlna.conf"
make_dirs="
 /var/lib/minidlna 0750 minidlna minidlna
 /var/log/minidlna 0750 minidlna minidlna"
hostmakedepends="pkg-config gettext automake gettext-devel-tools"
makedepends="ffmpeg-devel libjpeg-turbo-devel sqlite-devel libexif-devel
 libid3tag-devel libvorbis-devel libflac-devel"
short_desc="DLNA/UPnP-AV compliant media server"
maintainer="Duncaen <duncaen@voidlinux.org>"
license="GPL-2.0-only, BSD-3-Clause"
homepage="https://minidlna.sourceforge.net/"
changelog="https://sourceforge.net/projects/minidlna/files/minidlna/${version}/README/view"
#distfiles="${SOURCEFORGE_SITE}/${pkgname}/${pkgname}-${version}.tar.gz"
distfiles="https://sourceforge.net/code-snapshots/git/m/mi/minidlna/git.git/minidlna-git-${_hash}.zip"
checksum=6e13ecde024885694f37a7cc942032b37a32f8b3043e864ade95f07c2de6fa09

system_accounts="minidlna"
minidlna_homedir="/var/lib/minidlna"

CFLAGS="-fcommon"

if [ "$XBPS_TARGET_LIBC" = "musl" ]; then
	makedepends+=" musl-legacy-compat"
fi

pre_configure() {
	autoreconf -fvi
}

post_install() {
	vlicense LICENCE.miniupnpd # This one is BSD. COPYING is GPL-2
	vconf minidlna.conf
	vman minidlna.conf.5
	vman minidlnad.8
	vsv minidlnad
}
